# TextSync - Пошаговая инструкция по использованию

## Шаг 1: Настройка проекта на Vercel

### 1.1 Получите URL вашего проекта
После деплоя на Vercel, ваш проект доступен по адресу:
\`\`\`
https://your-project-name.vercel.app
\`\`\`

Этот URL понадобится для:
- Входа в админ-панель
- Настройки Figma плагина

### 1.2 Запустите SQL скрипты для создания таблиц

В v0 выполните SQL скрипты по порядку:
1. `scripts/001_create_texts_table.sql` - создает таблицу texts
2. `scripts/002_create_projects_table.sql` - создает таблицу projects
3. `scripts/003_add_category_column.sql` - добавляет колонку category

**Как запустить:**
- Нажмите на кнопку "Run" рядом с каждым SQL файлом в v0
- Или выполните их вручную в Supabase SQL Editor

---

## Шаг 2: Настройка GitHub проекта (опционально)

### 2.1 Создайте GitHub Personal Access Token

1. Зайдите на GitHub.com
2. Settings → Developer settings → Personal access tokens → Tokens (classic)
3. Generate new token (classic)
4. Выберите права: `repo` (полный доступ к репозиториям)
5. Скопируйте токен (показывается только один раз!)

### 2.2 Настройте проект в админ-панели

1. Откройте `https://your-project-name.vercel.app/login`
2. Введите пароль из переменной `ADMIN_PASSWORD`
3. Перейдите в "Projects" (кнопка в шапке)
4. Нажмите "Add Project"
5. Заполните форму:
   - **Name**: Название проекта (например, "Main App")
   - **GitHub Token**: Ваш токен из шага 2.1
   - **Owner**: Владелец репозитория (например, "mycompany")
   - **Repo**: Название репозитория (например, "my-app")
   - **Branch**: Ветка (например, "main")
   - **Path**: Путь к файлу (например, "locales/ru.json")
6. Нажмите "Create"
7. Нажмите "Set Active" чтобы сделать проект активным

---

## Шаг 3: Настройка Figma плагина

### 3.1 Установите плагин в Figma

1. Откройте **Figma Desktop** (не браузер!)
2. Меню → `Plugins` → `Development` → `Import plugin from manifest...`
3. Выберите файл `figma-plugin/manifest.json` из скачанного проекта
4. Плагин появится в меню: `Plugins` → `Development` → `TextSync`

### 3.2 Настройте URL API в плагине

1. Запустите плагин: `Plugins` → `Development` → `TextSync`
2. В поле "API URL" введите URL вашего проекта:
   \`\`\`
   https://your-project-name.vercel.app
   \`\`\`
3. URL сохранится автоматически

---

## Шаг 4: Полный рабочий процесс

### 4.1 Экспорт текстов из Figma в админку

1. **Подготовьте структуру в Figma:**
   \`\`\`
   Frame: "upload_photo"
     ├─ Text: "Загрузить фото"
     ├─ Text: "Выбрать файл"
     └─ Text: "Максимум 10 МБ"
   \`\`\`

2. **Запустите плагин:**
   - `Plugins` → `Development` → `TextSync`
   - Нажмите **"Export to Admin"**

3. **Что происходит:**
   - Плагин сканирует все текстовые слои
   - Генерирует уникальные ключи (например: `zagruzit_foto_x7k9`)
   - Добавляет префикс `T:` к имени слоя
   - Категория = имя родительского фрейма (`upload_photo`)
   - Отправляет в админку со статусом `draft`

4. **Результат в Figma:**
   \`\`\`
   Frame: "upload_photo"
     ├─ Text: "T:zagruzit_foto_x7k9" → "Загрузить фото"
     ├─ Text: "T:vybrat_fail_a2b3" → "Выбрать файл"
     └─ Text: "T:maksimum_10_mb_c4d5" → "Максимум 10 МБ"
   \`\`\`

### 4.2 Редактирование текстов в админке

1. **Откройте админ-панель:**
   \`\`\`
   https://your-project-name.vercel.app/admin
   \`\`\`

2. **Найдите тексты:**
   - Используйте поиск по ключу или значению
   - Фильтруйте по категории (`upload_photo`)
   - Фильтруйте по статусу (`draft`)

3. **Отредактируйте текст:**
   - Нажмите "Edit" на нужном тексте
   - Измените значение (например: "Загрузить фото" → "Загрузить изображение")
   - Статус автоматически изменится на `in_review`
   - Нажмите "Save"

### 4.3 Одобрение текстов

1. **В админке:**
   - Нажмите "Edit" на тексте со статусом `in_review`
   - Нажмите кнопку **"Approve"**
   - Статус изменится на `approved`

2. **Что происходит автоматически:**
   - Если настроен активный GitHub проект:
     - Система автоматически создает коммит в GitHub
     - Файл обновляется по пути, указанному в настройках проекта
     - Коммит-сообщение: "Update translations: <key>"

### 4.4 Синхронизация изменений обратно в Figma

1. **Откройте тот же файл в Figma**

2. **Запустите плагин:**
   - `Plugins` → `Development` → `TextSync`
   - Нажмите **"Pull Approved"**

3. **Что происходит:**
   - Плагин загружает только `approved` тексты из API
   - Находит слои с префиксом `T:` и соответствующим ключом
   - Обновляет текст в этих слоях
   - Показывает статистику: "Updated 3 text nodes"

4. **Результат в Figma:**
   \`\`\`
   Frame: "upload_photo"
     ├─ Text: "T:zagruzit_foto_x7k9" → "Загрузить изображение" ✅ обновлено
     ├─ Text: "T:vybrat_fail_a2b3" → "Выбрать файл"
     └─ Text: "T:maksimum_10_mb_c4d5" → "Максимум 10 МБ"
   \`\`\`

---

## Шаг 5: Экспорт JSON вручную (без GitHub)

Если не настроили GitHub интеграцию:

1. **В админке:**
   - Нажмите кнопку **"Export JSON"** в шапке
   - Скачается файл `ru.json` с одобренными текстами

2. **Формат файла:**
   \`\`\`json
   {
     "zagruzit_foto_x7k9": "Загрузить изображение",
     "vybrat_fail_a2b3": "Выбрать файл",
     "maksimum_10_mb_c4d5": "Максимум 10 МБ"
   }
   \`\`\`

3. **Вручную закоммитьте в репозиторий**

---

## Типичные проблемы и решения

### Плагин не запускается
- Убедитесь, что используете Figma Desktop (не браузер)
- Проверьте, что файл `code.js` существует в папке `figma-plugin/`

### Ошибка "API error" в плагине
- Проверьте URL в плагине (должен быть `https://your-project-name.vercel.app`)
- Убедитесь, что проект задеплоен и доступен
- Проверьте, что SQL скрипты выполнены

### Тексты не обновляются при Pull
- Убедитесь, что тексты имеют статус `approved` в админке
- Проверьте, что слои имеют префикс `T:` в имени
- Убедитесь, что используете тот же файл Figma

### Пустая страница в админке
- Проверьте, что переменная `ADMIN_PASSWORD` установлена в Vercel
- Проверьте консоль браузера на ошибки
- Убедитесь, что SQL скрипты выполнены

### GitHub синхронизация не работает
- Проверьте, что проект настроен и активен в админке
- Проверьте права GitHub токена (должен быть `repo`)
- Проверьте, что путь к файлу корректный

---

## Краткая шпаргалка

\`\`\`
1. Figma → Export to Admin
   ↓
2. Admin → Edit & Approve
   ↓
3. GitHub ← Auto-sync (если настроено)
   ↓
4. Figma ← Pull Approved
\`\`\`

**URL для плагина:**
\`\`\`
https://your-project-name.vercel.app
\`\`\`

**Структура ключей:**
\`\`\`
T:<slugified_text>_<hash>
\`\`\`

**Категории:**
\`\`\`
Имя родительского фрейма = категория
\`\`\`

**Статусы:**
\`\`\`
draft → in_review → approved
